



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Annotation - AWS ALB Ingress Controller</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#ingress-annotations" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="AWS ALB Ingress Controller" aria-label="AWS ALB Ingress Controller" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              AWS ALB Ingress Controller
            </span>
            <span class="md-header-nav__topic">
              
                Annotation
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/kubernetes-sigs/aws-alb-ingress-controller/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    kubernetes-sigs/aws-alb-ingress-controller
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../.." class="md-tabs__link">
          Home
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../controller/config/" class="md-tabs__link">
          Guide
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../CONTRIBUTING/" class="md-tabs__link">
          About
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="AWS ALB Ingress Controller" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    AWS ALB Ingress Controller
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/kubernetes-sigs/aws-alb-ingress-controller/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    kubernetes-sigs/aws-alb-ingress-controller
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Home
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Home
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../controller/how-it-works/" title="How it works" class="md-nav__link">
      How it works
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Controller
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        Controller
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../controller/config/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../controller/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" checked>
    
    <label class="md-nav__link" for="nav-2-2">
      Ingress
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Ingress
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Annotation
      </label>
    
    <a href="./" title="Annotation" class="md-nav__link md-nav__link--active">
      Annotation
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#annotations" class="md-nav__link">
    Annotations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traffic-listening" class="md-nav__link">
    Traffic Listening
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traffic-routing" class="md-nav__link">
    Traffic Routing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-control" class="md-nav__link">
    Access control
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#health-check" class="md-nav__link">
    Health Check
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#waf" class="md-nav__link">
    WAF
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shield-advanced" class="md-nav__link">
    Shield Advanced
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssl" class="md-nav__link">
    SSL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-attributes" class="md-nav__link">
    Custom attributes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-tags" class="md-nav__link">
    Resource Tags
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../spec/" title="Spec" class="md-nav__link">
      Spec
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      External DNS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        External DNS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../external-dns/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Tasks
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Tasks
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tasks/ssl_redirect/" title="SSL Redirect" class="md-nav__link">
      SSL Redirect
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Cognito
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Cognito
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cognito/setup/" title="Cognito Integration" class="md-nav__link">
      Cognito Integration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      Walkthrough
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        Walkthrough
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../walkthrough/echoserver/" title="Echo server" class="md-nav__link">
      Echo server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../CONTRIBUTING/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../BUILDING/" title="Building" class="md-nav__link">
      Building
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ROADMAP/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#annotations" class="md-nav__link">
    Annotations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traffic-listening" class="md-nav__link">
    Traffic Listening
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traffic-routing" class="md-nav__link">
    Traffic Routing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-control" class="md-nav__link">
    Access control
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#authentication" class="md-nav__link">
    Authentication
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#health-check" class="md-nav__link">
    Health Check
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#waf" class="md-nav__link">
    WAF
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shield-advanced" class="md-nav__link">
    Shield Advanced
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssl" class="md-nav__link">
    SSL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-attributes" class="md-nav__link">
    Custom attributes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-tags" class="md-nav__link">
    Resource Tags
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/kubernetes-sigs/aws-alb-ingress-controller/edit/master/docs/guide/ingress/annotation.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="ingress-annotations">Ingress annotations<a class="headerlink" href="#ingress-annotations" title="Permanent link">&para;</a></h1>
<p>You can add kubernetes annotations to ingress and service objects to customize their behavior.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>Annotations applied to service have higher priority over annotations applied to ingress. <code class="codehilite"><span class="err">Location</span></code> column below indicates where that annotation can be applied to.</li>
<li>Annotation keys and values can only be strings. Advanced format are encoded as below:<ul>
<li>boolean: 'true'</li>
<li>integer: '42'</li>
<li>stringMap: k1=v1,k2=v2</li>
<li>stringList: s1,s2,s3</li>
<li>json: 'jsonContent'</li>
</ul>
</li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The annotation prefix can be changed using the <code class="codehilite"><span class="err">--annotations-prefix</span></code> command line argument, by default it's <code class="codehilite"><span class="err">alb.ingress.kubernetes.io</span></code>, as described in the table below.</p>
</div>
<h2 id="annotations">Annotations<a class="headerlink" href="#annotations" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Location</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#actions">alb.ingress.kubernetes.io/actions.${action-name}</a></td>
<td>json</td>
<td>N/A</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#auth-idp-cognito">alb.ingress.kubernetes.io/auth-idp-cognito</a></td>
<td>json</td>
<td>N/A</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#auth-idp-oidc">alb.ingress.kubernetes.io/auth-idp-oidc</a></td>
<td>json</td>
<td>N/A</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#auth-on-unauthenticated-request">alb.ingress.kubernetes.io/auth-on-unauthenticated-request</a></td>
<td>authenticate|allow|deny</td>
<td>authenticate</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#auth-scope">alb.ingress.kubernetes.io/auth-scope</a></td>
<td>string</td>
<td>openid</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#auth-session-cookie">alb.ingress.kubernetes.io/auth-session-cookie</a></td>
<td>string</td>
<td>AWSELBAuthSessionCookie</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#auth-session-timeout">alb.ingress.kubernetes.io/auth-session-timeout</a></td>
<td>integer</td>
<td>'604800'</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#auth-type">alb.ingress.kubernetes.io/auth-type</a></td>
<td>none|oidc|cognito</td>
<td>none</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#backend-protocol">alb.ingress.kubernetes.io/backend-protocol</a></td>
<td>HTTP | HTTPS</td>
<td>HTTP</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#certificate-arn">alb.ingress.kubernetes.io/certificate-arn</a></td>
<td>stringList</td>
<td>N/A</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#conditions">alb.ingress.kubernetes.io/conditions.${conditions-name}</a></td>
<td>json</td>
<td>N/A</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#healthcheck-interval-seconds">alb.ingress.kubernetes.io/healthcheck-interval-seconds</a></td>
<td>integer</td>
<td>'15'</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#healthcheck-path">alb.ingress.kubernetes.io/healthcheck-path</a></td>
<td>string</td>
<td>/</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#healthcheck-port">alb.ingress.kubernetes.io/healthcheck-port</a></td>
<td>integer | traffic-port</td>
<td>traffic-port</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#healthcheck-protocol">alb.ingress.kubernetes.io/healthcheck-protocol</a></td>
<td>HTTP | HTTPS</td>
<td>HTTP</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#healthcheck-timeout-seconds">alb.ingress.kubernetes.io/healthcheck-timeout-seconds</a></td>
<td>integer</td>
<td>'5'</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#healthy-threshold-count">alb.ingress.kubernetes.io/healthy-threshold-count</a></td>
<td>integer</td>
<td>'2'</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#inbound-cidrs">alb.ingress.kubernetes.io/inbound-cidrs</a></td>
<td>stringList</td>
<td>0.0.0.0/0</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#ip-address-type">alb.ingress.kubernetes.io/ip-address-type</a></td>
<td>ipv4 | dualstack</td>
<td>ipv4</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#listen-ports">alb.ingress.kubernetes.io/listen-ports</a></td>
<td>json</td>
<td>'[{"HTTP": 80}]' | '[{"HTTPS": 443}]'</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#load-balancer-attributes">alb.ingress.kubernetes.io/load-balancer-attributes</a></td>
<td>stringMap</td>
<td>N/A</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#scheme">alb.ingress.kubernetes.io/scheme</a></td>
<td>internal | internet-facing</td>
<td>internal</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#security-groups">alb.ingress.kubernetes.io/security-groups</a></td>
<td>stringList</td>
<td>N/A</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#shield-advanced-protection">alb.ingress.kubernetes.io/shield-advanced-protection</a></td>
<td>boolean</td>
<td>N/A</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#ssl-policy">alb.ingress.kubernetes.io/ssl-policy</a></td>
<td>string</td>
<td>ELBSecurityPolicy-2016-08</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#subnets">alb.ingress.kubernetes.io/subnets</a></td>
<td>stringList</td>
<td>N/A</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#success-codes">alb.ingress.kubernetes.io/success-codes</a></td>
<td>string</td>
<td>'200'</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#tags">alb.ingress.kubernetes.io/tags</a></td>
<td>stringMap</td>
<td>N/A</td>
<td>ingress</td>
</tr>
<tr>
<td><a href="#target-group-attributes">alb.ingress.kubernetes.io/target-group-attributes</a></td>
<td>stringMap</td>
<td>N/A</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#target-type">alb.ingress.kubernetes.io/target-type</a></td>
<td>instance | ip</td>
<td>instance</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#unhealthy-threshold-count">alb.ingress.kubernetes.io/unhealthy-threshold-count</a></td>
<td>integer</td>
<td>'2'</td>
<td>ingress,service</td>
</tr>
<tr>
<td><a href="#waf-acl-id">alb.ingress.kubernetes.io/waf-acl-id</a></td>
<td>string</td>
<td>N/A</td>
<td>ingress</td>
</tr>
</tbody>
</table>
<h2 id="traffic-listening">Traffic Listening<a class="headerlink" href="#traffic-listening" title="Permanent link">&para;</a></h2>
<p>Traffic Listening can be controlled with following annotations:</p>
<ul>
<li>
<p><a name="listen-ports"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/listen-ports</span></code></a> specifies the ports that ALB used to listen on.</p>
<div class="admonition note">
<p>defaults to <code class="codehilite"><span class="err">&#39;[{&quot;HTTP&quot;: 80}]&#39;</span></code> or <code class="codehilite"><span class="err">&#39;[{&quot;HTTPS&quot;: 443}]&#39;</span></code> depends on whether <code class="codehilite"><span class="err">certificate-arn</span></code> is specified.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/listen-ports: &#39;[{&quot;HTTP&quot;: 80}, {&quot;HTTPS&quot;: 443}, {&quot;HTTP&quot;: 8080}, {&quot;HTTPS&quot;: 8443}]&#39;</span>
</code></pre></div>

</div>
<div class="admonition warning">
<p>You may not have duplicate load balancer ports defined.</p>
</div>
</li>
<li>
<p><a name="ip-address-type"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/ip-address-type</span></code></a> specifies the <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/application-load-balancers.html#ip-address-type">IP address type</a> of ALB.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/ip-address-type: ipv4</span>
</code></pre></div>

</div>
</li>
</ul>
<h2 id="traffic-routing">Traffic Routing<a class="headerlink" href="#traffic-routing" title="Permanent link">&para;</a></h2>
<p>Traffic Routing can be controlled with following annotations:</p>
<ul>
<li>
<p><a name="target-type"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/target-type</span></code></a> specifies how to route traffic to pods. You can choose between <code class="codehilite"><span class="err">instance</span></code> and <code class="codehilite"><span class="err">ip</span></code>:</p>
<ul>
<li>
<p><code class="codehilite"><span class="err">instance</span></code> mode will route traffic to all ec2 instances within cluster on <a href="https://kubernetes.io/docs/concepts/services-networking/service/#nodeport">NodePort</a> opened for your service.</p>
<div class="admonition note">
<p>service must be of type "NodePort" or "LoadBalancer" to use <code class="codehilite"><span class="err">instance</span></code> mode</p>
</div>
</li>
<li>
<p><code class="codehilite"><span class="err">ip</span></code> mode will route traffic directly to the pod IP.</p>
<div class="admonition note">
<p>network plugin must use secondary IP addresses on <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html">ENI</a> for pod IP to use <code class="codehilite"><span class="err">ip</span></code> mode. e.g.</p>
<ul>
<li><a href="https://github.com/aws/amazon-vpc-cni-k8s">amazon-vpc-cni-k8s</a></li>
</ul>
</div>
</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/target-type: instance</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="backend-protocol"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/backend-protocol</span></code></a> specifies the protocol used when route traffic to pods.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/backend-protocol: HTTPS</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="subnets"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/subnets</span></code></a> specifies the <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html">Availability Zone</a> that ALB will route traffic to. See <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-subnets.html">Load Balancer subnets</a> for more details.</p>
<div class="admonition note">
<p>You must specify at least two subnets in different AZ. both subnetID or subnetName(Name tag on subnets) can be used.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can enable subnet auto discovery to avoid specify this annotation on every ingress. See <a href="../../controller/config/#subnet-auto-discovery">Subnet Auto Discovery</a> for instructions.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/subnets: subnet-xxxx, mySubnet</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="actions"><code class="codehilite">alb.ingress.kubernetes.io/actions.<span class="cp">${</span><span class="n">action</span><span class="o">-</span><span class="n">name</span><span class="cp">}</span></code></a> Provides a method for configuring custom actions on a listener, such as for Redirect Actions.</p>
<p>The <code class="codehilite"><span class="err">action-name</span></code> in the annotation must match the serviceName in the ingress rules, and servicePort must be <code class="codehilite"><span class="err">use-annotation</span></code>.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<ul>
<li>response-503: return fixed 503 response</li>
<li>redirect-to-eks: redirect to an external url</li>
<li>forward-single-tg: forward to an single targetGroup [<strong>simplified schema</strong>]</li>
<li>forward-multiple-tg: forward to multiple targetGroups with different weights and stickiness config [<strong>advanced schema</strong>]</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ingress</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alb</span>
    <span class="nt">alb.ingress.kubernetes.io/scheme</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">internet-facing</span>
    <span class="nt">alb.ingress.kubernetes.io/actions.response-503</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">{&quot;Type&quot;:&quot;fixed-response&quot;,&quot;FixedResponseConfig&quot;:{&quot;ContentType&quot;:&quot;text/plain&quot;,&quot;StatusCode&quot;:&quot;503&quot;,&quot;MessageBody&quot;:&quot;503 error text&quot;}}</span>
    <span class="nt">alb.ingress.kubernetes.io/actions.redirect-to-eks</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">{&quot;Type&quot;:&quot;redirect&quot;,&quot;RedirectConfig&quot;:{&quot;Host&quot;:&quot;aws.amazon.com&quot;,&quot;Path&quot;:&quot;/eks/&quot;,&quot;Port&quot;:&quot;443&quot;,&quot;Protocol&quot;:&quot;HTTPS&quot;,&quot;Query&quot;:&quot;k=v&quot;,&quot;StatusCode&quot;:&quot;HTTP_302&quot;}}</span>
    <span class="nt">alb.ingress.kubernetes.io/actions.forward-single-tg</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">{&quot;Type&quot;:&quot;forward&quot;,&quot;TargetGroupArn&quot;: &quot;arn-of-your-target-group&quot;}</span>
    <span class="nt">alb.ingress.kubernetes.io/actions.forward-multiple-tg</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">{&quot;Type&quot;:&quot;forward&quot;,&quot;ForwardConfig&quot;:{&quot;TargetGroups&quot;:[{&quot;ServiceName&quot;:&quot;service-1&quot;,&quot;ServicePort&quot;:&quot;80&quot;,&quot;Weight&quot;:20},{&quot;ServiceName&quot;:&quot;service-2&quot;,&quot;ServicePort&quot;:&quot;80&quot;,&quot;Weight&quot;:20},{&quot;TargetGroupArn&quot;:&quot;&quot;arn-of-your-non-k8s-target-group&quot;,&quot;Weight&quot;:60}],&quot;TargetGroupStickinessConfig&quot;:{&quot;Enabled&quot;:true,&quot;DurationSeconds&quot;:200}}}</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">rules</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">http</span><span class="p">:</span>
        <span class="nt">paths</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/503</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">response-503</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">use-annotation</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/eks</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">redirect-to-eks</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">use-annotation</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/path1</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">forward-single-tg</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">use-annotation</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/path2</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">forward-multiple-tg</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">use-annotation</span>
</code></pre></div>

</div>
<div class="admonition note">
<p class="admonition-title">use ARN in forward Action</p>
<p>ARN can be used in forward action(both simplified schema and advanced schema), it must be an targetGroup created outside of k8s, typically an targetGroup for legacy application.</p>
</div>
<div class="admonition note">
<p class="admonition-title">use ServiceName/ServicePort in forward Action</p>
<p>ServiceName/ServicePort can be used in forward action(advanced schema only).</p>
<p>Limitation: <a href="#authentication">Auth related annotations</a> on Service object won't be respected, it must be applied to Ingress object.</p>
</div>
</li>
<li>
<p><a name="conditions"><code class="codehilite">alb.ingress.kubernetes.io/conditions.<span class="cp">${</span><span class="n">conditions</span><span class="o">-</span><span class="n">name</span><span class="cp">}</span></code></a> Provides a method for specifying routing conditions <strong>in addition to original host/path condition on Ingress spec</strong>. </p>
<p>The <code class="codehilite"><span class="err">conditions-name</span></code> in the annotation must match the serviceName in the ingress rules. 
It can be a either real serviceName or an annotation based action name when servicePort is "use-annotation".</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<ul>
<li>rule-path1: <ul>
<li>Host is www.example.com OR anno.example.com</li>
<li>Path is /path1</li>
</ul>
</li>
<li>rule-path2:<ul>
<li>Host is www.example.com</li>
<li>Path is /path2 OR /anno/path2</li>
</ul>
</li>
<li>rule-path3:<ul>
<li>Host is www.example.com</li>
<li>Path is /path3</li>
<li>Http header HeaderName is HeaderValue1 OR HeaderValue2</li>
</ul>
</li>
<li>rule-path4:<ul>
<li>Host is www.example.com</li>
<li>Path is /path4</li>
<li>Http request method is GET OR HEAD</li>
</ul>
</li>
<li>rule-path5:<ul>
<li>Host is www.example.com</li>
<li>Path is /path5</li>
<li>Query string is paramA:valueA1 OR paramA:valueA2</li>
</ul>
</li>
<li>rule-path6:<ul>
<li>Host is www.example.com</li>
<li>Path is /path6</li>
<li>Source IP is192.168.0.0/16 OR 172.16.0.0/16</li>
</ul>
</li>
<li>rule-path7:<ul>
<li>Host is www.example.com</li>
<li>Path is /path6</li>
<li>Http header HeaderName is HeaderValue</li>
<li>Query string is paramA:valueA</li>
<li>Query string is paramB:valueB</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ingress</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alb</span>
    <span class="nt">alb.ingress.kubernetes.io/scheme</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">internet-facing</span>
    <span class="nt">alb.ingress.kubernetes.io/actions.rule-path1</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">{&quot;Type&quot;:&quot;fixed-response&quot;,&quot;FixedResponseConfig&quot;:{&quot;ContentType&quot;:&quot;text/plain&quot;,&quot;StatusCode&quot;:&quot;200&quot;,&quot;MessageBody&quot;:&quot;Host is www.example.com OR anno.example.com&quot;}}</span>
    <span class="nt">alb.ingress.kubernetes.io/conditions.rule-path1</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">[{&quot;Field&quot;:&quot;host-header&quot;,&quot;HostHeaderConfig&quot;:{&quot;Values&quot;:[&quot;anno.example.com&quot;]}}]</span>
    <span class="nt">alb.ingress.kubernetes.io/actions.rule-path2</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">{&quot;Type&quot;:&quot;fixed-response&quot;,&quot;FixedResponseConfig&quot;:{&quot;ContentType&quot;:&quot;text/plain&quot;,&quot;StatusCode&quot;:&quot;200&quot;,&quot;MessageBody&quot;:&quot;Path is /path2 OR /anno/path2&quot;}}</span>
    <span class="nt">alb.ingress.kubernetes.io/conditions.rule-path2</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">[{&quot;Field&quot;:&quot;path-pattern&quot;,&quot;PathPatternConfig&quot;:{&quot;Values&quot;:[&quot;/anno/path2&quot;]}}]</span>
    <span class="nt">alb.ingress.kubernetes.io/actions.rule-path3</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">{&quot;Type&quot;:&quot;fixed-response&quot;,&quot;FixedResponseConfig&quot;:{&quot;ContentType&quot;:&quot;text/plain&quot;,&quot;StatusCode&quot;:&quot;200&quot;,&quot;MessageBody&quot;:&quot;Http header HeaderName is HeaderValue1 OR HeaderValue2&quot;}}</span>
    <span class="nt">alb.ingress.kubernetes.io/conditions.rule-path3</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">[{&quot;Field&quot;:&quot;http-header&quot;,&quot;HttpHeaderConfig&quot;:{&quot;HttpHeaderName&quot;: &quot;HeaderName&quot;, &quot;Values&quot;:[&quot;HeaderValue1&quot;, &quot;HeaderValue2&quot;]}}]</span>
    <span class="nt">alb.ingress.kubernetes.io/actions.rule-path4</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">{&quot;Type&quot;:&quot;fixed-response&quot;,&quot;FixedResponseConfig&quot;:{&quot;ContentType&quot;:&quot;text/plain&quot;,&quot;StatusCode&quot;:&quot;200&quot;,&quot;MessageBody&quot;:&quot;Http request method is GET OR HEAD&quot;}}</span>
    <span class="nt">alb.ingress.kubernetes.io/conditions.rule-path4</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">[{&quot;Field&quot;:&quot;http-request-method&quot;,&quot;HttpRequestMethodConfig&quot;:{&quot;Values&quot;:[&quot;GET&quot;, &quot;HEAD&quot;]}}]</span>
    <span class="nt">alb.ingress.kubernetes.io/actions.rule-path5</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">{&quot;Type&quot;:&quot;fixed-response&quot;,&quot;FixedResponseConfig&quot;:{&quot;ContentType&quot;:&quot;text/plain&quot;,&quot;StatusCode&quot;:&quot;200&quot;,&quot;MessageBody&quot;:&quot;Query string is paramA:valueA1 OR paramA:valueA2&quot;}}</span>
    <span class="nt">alb.ingress.kubernetes.io/conditions.rule-path5</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">[{&quot;Field&quot;:&quot;query-string&quot;,&quot;QueryStringConfig&quot;:{&quot;Values&quot;:[{&quot;Key&quot;:&quot;paramA&quot;,&quot;Value&quot;:&quot;valueA1&quot;},{&quot;Key&quot;:&quot;paramA&quot;,&quot;Value&quot;:&quot;valueA2&quot;}]}}]</span>
    <span class="nt">alb.ingress.kubernetes.io/actions.rule-path6</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">{&quot;Type&quot;:&quot;fixed-response&quot;,&quot;FixedResponseConfig&quot;:{&quot;ContentType&quot;:&quot;text/plain&quot;,&quot;StatusCode&quot;:&quot;200&quot;,&quot;MessageBody&quot;:&quot;Source IP is 192.168.0.0/16 OR 172.16.0.0/16&quot;}}</span>
    <span class="nt">alb.ingress.kubernetes.io/conditions.rule-path6</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">[{&quot;Field&quot;:&quot;source-ip&quot;,&quot;SourceIpConfig&quot;:{&quot;Values&quot;:[&quot;192.168.0.0/16&quot;, &quot;172.16.0.0/16&quot;]}}]</span>
    <span class="nt">alb.ingress.kubernetes.io/actions.rule-path7</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">{&quot;Type&quot;:&quot;fixed-response&quot;,&quot;FixedResponseConfig&quot;:{&quot;ContentType&quot;:&quot;text/plain&quot;,&quot;StatusCode&quot;:&quot;200&quot;,&quot;MessageBody&quot;:&quot;multiple conditions applies&quot;}}</span>
    <span class="nt">alb.ingress.kubernetes.io/conditions.rule-path7</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
      <span class="no">[{&quot;Field&quot;:&quot;http-header&quot;,&quot;HttpHeaderConfig&quot;:{&quot;HttpHeaderName&quot;: &quot;HeaderName&quot;, &quot;Values&quot;:[&quot;HeaderValue&quot;]}},{&quot;Field&quot;:&quot;query-string&quot;,&quot;QueryStringConfig&quot;:{&quot;Values&quot;:[{&quot;Key&quot;:&quot;paramA&quot;,&quot;Value&quot;:&quot;valueA&quot;}]}},{&quot;Field&quot;:&quot;query-string&quot;,&quot;QueryStringConfig&quot;:{&quot;Values&quot;:[{&quot;Key&quot;:&quot;paramB&quot;,&quot;Value&quot;:&quot;valueB&quot;}]}}]</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">rules</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">www.example.com</span>
      <span class="nt">http</span><span class="p">:</span>
        <span class="nt">paths</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/path1</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rule-path1</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">use-annotation</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/path2</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rule-path2</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">use-annotation</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/path3</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rule-path3</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">use-annotation</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/path4</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rule-path4</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">use-annotation</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/path5</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rule-path5</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">use-annotation</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/path6</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rule-path6</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">use-annotation</span>
          <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/path7</span>
            <span class="nt">backend</span><span class="p">:</span>
              <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rule-path7</span>
              <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">use-annotation</span>
</code></pre></div>

</div>
<div class="admonition warning">
<p class="admonition-title">limitations</p>
<p>General ALB limitations applies:</p>
<ol>
<li>
<p>Each rule can optionally include up to one of each of the following conditions: host-header, http-request-method, path-pattern, and source-ip. Each rule can also optionally include one or more of each of the following conditions: http-header and query-string.</p>
</li>
<li>
<p>You can specify up to three match evaluations per condition.</p>
</li>
<li>
<p>You can specify up to five match evaluations per rule.</p>
</li>
</ol>
<p>Refer <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html#rule-condition-types">ALB documentation</a> for more details.</p>
</div>
</li>
</ul>
<h2 id="access-control">Access control<a class="headerlink" href="#access-control" title="Permanent link">&para;</a></h2>
<p>Access control for LoadBalancer can be controlled with following annotations:</p>
<ul>
<li>
<p><a name="scheme"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/scheme</span></code></a> specifies whether your LoadBalancer will be internet facing. See <a href="http://docs.aws.amazon.com/elasticloadbalancing/latest/userguide/how-elastic-load-balancing-works.html#load-balancer-scheme">Load balancer scheme</a> in the AWS documentation for more details.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/scheme: internal</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="inbound-cidrs"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/inbound-cidrs</span></code></a> specifies the CIDRs that are allowed to access LoadBalancer.</p>
<div class="admonition warning">
<p>this annotation will be ignored if <code class="codehilite"><span class="err">alb.ingress.kubernetes.io/security-groups</span></code> is specified.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/inbound-cidrs: 10.0.0.0/24</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="security-groups"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/security-groups</span></code></a> specifies the securityGroups you want to attach to LoadBalancer.</p>
<div class="admonition note">
<p>When this annotation is not present, the controller will automatically create 2 security groups: the first security group will be attached to the LoadBalancer and allow access from <a href="#inbound-cidrs"><code class="codehilite"><span class="err">inbound-cidrs</span></code></a> to the <a href="#listen-ports"><code class="codehilite"><span class="err">listen-ports</span></code></a>. The second security group will be attached to the EC2 instance(s) and allow all TCP traffic from the first security group created for the LoadBalancer.</p>
</div>
<div class="admonition tip">
<p>Both name or ID of securityGroups are supported. Name matches a <code class="codehilite"><span class="err">Name</span></code> tag, not the <code class="codehilite"><span class="err">groupName</span></code> attribute.</p>
</div>
<div class="admonition warning">
<p>The <a href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html#limits_vpc">default limit</a> of security groups per network interface in AWS is 5. This limit is quickly reached when multiple load balancers are provisioned by the controller without this annotation, therefore it is recommended to set this annotation to a self-managed security group (or request AWS support to increase the number of security groups per network interface for your AWS account). If this annotation is specified, you should also manage the security group used by the EC2 instances to allow inbound traffic from the security group attached to the LoadBalancer.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/security-groups: sg-xxxx, nameOfSg1, nameOfSg2</span>
</code></pre></div>

</div>
</li>
</ul>
<h2 id="authentication">Authentication<a class="headerlink" href="#authentication" title="Permanent link">&para;</a></h2>
<p>ALB supports authentication with Cognito or OIDC. See <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/listener-authenticate-users.html">Authenticate Users Using an Application Load Balancer</a> for more details.</p>
<div class="admonition warning">
<p class="admonition-title">HTTPS only</p>
<p>Authentication is only supported for HTTPS listeners, see <a href="#ssl">SSL</a> for configure HTTPS listener.</p>
</div>
<ul>
<li>
<p><a name="auth-type"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/auth-type</span></code></a> specifies the authentication type on targets.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/auth-type: cognito</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="auth-idp-cognito"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/auth-idp-cognito</span></code></a> specifies the cognito idp configuration.</p>
<div class="admonition tip">
<p>If you are using Amazon Cognito Domain, the <code class="codehilite"><span class="err">UserPoolDomain</span></code> should be set to the domain prefix(xxx) instead of full domain(https://xxx.auth.us-west-2.amazoncognito.com)</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/auth-idp-cognito: &#39;{&quot;UserPoolArn&quot;:&quot;arn:aws:cognito-idp:us-west-2:xxx:userpool/xxx&quot;, &quot;UserPoolClientId&quot;:&quot;xxx&quot;, &quot;UserPoolDomain&quot;:&quot;xxx&quot;}&#39;</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="auth-idp-oidc"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/auth-idp-oidc</span></code></a> specifies the oidc idp configuration.</p>
<div class="admonition tip">
<p>You need to create an <a href="https://kubernetes.io/docs/concepts/configuration/secret/">secret</a> within the same namespace as ingress to hold your OIDC clientID and clientSecret. The format of secret is as below:
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">testcase</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">customizedSecretName</span>
<span class="nt">data</span><span class="p">:</span>
  <span class="nt">clientId</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">base64 of your plain text clientId</span>
  <span class="nt">clientSecret</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">base64 of your plain text clientSecret</span>
</code></pre></div></p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/auth-idp-oidc: &#39;{&quot;Issuer&quot;:&quot;xxx&quot;,&quot;AuthorizationEndpoint&quot;:&quot;xxx&quot;,&quot;TokenEndpoint&quot;:&quot;xxx&quot;,&quot;UserInfoEndpoint&quot;:&quot;xxx&quot;,&quot;SecretName&quot;:&quot;customizedSecretName&quot;}&#39;</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="auth-on-unauthenticated-request"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/auth-on-unauthenticated-request</span></code></a> specifies the behavior if the user is not authenticated.</p>
<div class="admonition info">
<p class="admonition-title">options:</p>
<ul>
<li><strong>authenticate</strong>: try authenticate with configured IDP.</li>
<li><strong>deny</strong>: return an HTTP 401 Unauthorized error.</li>
<li><strong>allow</strong>: allow the request to be forwarded to the target.</li>
</ul>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/auth-on-unauthenticated-request: authenticate</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="auth-scope"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/auth-scope</span></code></a> specifies the set of user claims to be requested from the IDP(cognito or oidc), in a space-separated list.</p>
<div class="admonition info">
<p class="admonition-title">options:</p>
</div>
<ul>
<li><strong>phone</strong></li>
<li><strong>email</strong></li>
<li><strong>profile</strong></li>
<li><strong>openid</strong></li>
<li><strong>aws.cognito.signin.user.admin</strong></li>
</ul>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/auth-scope: &#39;email openid&#39;</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="auth-session-cookie"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/auth-session-cookie</span></code></a> specifies the name of the cookie used to maintain session information</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/auth-session-cookie: custom-cookie</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="auth-session-timeout"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/auth-session-timeout</span></code></a> specifies the maximum duration of the authentication session, in seconds</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/auth-session-timeout: &#39;86400&#39;</span>
</code></pre></div>

</div>
</li>
</ul>
<h2 id="health-check">Health Check<a class="headerlink" href="#health-check" title="Permanent link">&para;</a></h2>
<p>Health check on target groups can be controlled with following annotations:</p>
<ul>
<li>
<p><a name="healthcheck-protocol"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/healthcheck-protocol</span></code></a> specifies the protocol used when performing health check on targets.</p>
<div class="admonition tip">
<p>default protocol can be set via <code class="codehilite"><span class="err">--backend-protocol</span></code> flag</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/healthcheck-protocol: HTTPS</span></code></p>
</div>
</li>
<li>
<p><a name="healthcheck-port"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/healthcheck-port</span></code></a> specifies the port used when performing health check on targets.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<ul>
<li>set the healthcheck port to the traffic port
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/healthcheck-port: traffic-port</span>
</code></pre></div></li>
<li>set the healthcheck port to the NodePort(when target-type=instance) or TargetPort(when target-type=ip) of a named port
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/healthcheck-port: my-port</span>
</code></pre></div></li>
<li>set the healthcheck port to 80/tcp
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/healthcheck-port: &#39;80&#39;</span>
</code></pre></div></li>
</ul>
</div>
<div class="admonition warning">
<p>When using <code class="codehilite"><span class="c">target-type: instance</span></code> with a service of type "NodePort", the healthcheck port can be set to <code class="codehilite"><span class="err">traffic-port</span></code> to automatically point to the correct port.</p>
</div>
</li>
<li>
<p><a name="healthcheck-path"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/healthcheck-path</span></code></a> specifies the HTTP path when performing health check on targets.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/healthcheck-path: /ping</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="healthcheck-interval-seconds"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/healthcheck-interval-seconds</span></code></a> specifies the interval(in seconds) between health check of an individual target.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/healthcheck-interval-seconds: &#39;10&#39;</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="healthcheck-timeout-seconds"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/healthcheck-timeout-seconds</span></code></a> specifies the timeout(in seconds) during which no response from a target means a failed health check</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/healthcheck-timeout-seconds: &#39;8&#39;</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="success-codes"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/success-codes</span></code></a> specifies the HTTP status code that should be expected when doing health checks against the specified health check path.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<ul>
<li>use single value
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/success-codes: &#39;200&#39;</span>
</code></pre></div></li>
<li>use multiple values
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/success-codes: 200,201</span>
</code></pre></div></li>
<li>use range of value
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/success-codes: 200-300</span>
</code></pre></div></li>
</ul>
</div>
</li>
<li>
<p><a name="healthy-threshold-count"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/healthy-threshold-count</span></code></a> specifies the consecutive health checks successes required before considering an unhealthy target healthy.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/healthy-threshold-count: &#39;2&#39;</span>
</code></pre></div>

</div>
</li>
<li>
<p><a name="unhealthy-threshold-count"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/unhealthy-threshold-count</span></code></a> specifies the consecutive health check failures required before considering a target unhealthy.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/unhealthy-threshold-count: &#39;2&#39;</span></code></p>
</div>
</li>
</ul>
<h2 id="waf">WAF<a class="headerlink" href="#waf" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><a name="waf-acl-id"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/waf-acl-id</span></code></a> specifies the identifier for the Amzon WAF web ACL.</p>
<div class="admonition warning">
<p>Only Regional WAF is supported.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/waf-acl-id: 499e8b99-6671-4614-a86d-adb1810b7fbe</span></code></p>
</div>
</li>
</ul>
<h2 id="shield-advanced">Shield Advanced<a class="headerlink" href="#shield-advanced" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><a name="shield-advanced-protection"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/shield-advanced-protection</span></code></a> turns on / off the AWS Shield Advanced protection for the load balancer.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/shield-advanced-protection: &#39;true&#39;</span></code></p>
</div>
</li>
</ul>
<h2 id="ssl">SSL<a class="headerlink" href="#ssl" title="Permanent link">&para;</a></h2>
<p>SSL support can be controlled with following annotations:</p>
<ul>
<li>
<p><a name="certificate-arn"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/certificate-arn</span></code></a> specifies the ARN of one or more certificate managed by <a href="https://aws.amazon.com/certificate-manager">AWS Certificate Manager</a></p>
<div class="admonition tip">
<p>The first certificate in the list will be added as default certificate. And remaining certificate will be added to the optional certificate list.
See <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html#https-listener-certificates">SSL Certificates</a> for more details.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<ul>
<li>single certificate
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-west-2:xxxxx:certificate/xxxxxxx</span>
</code></pre></div></li>
<li>multiple certificates
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-west-2:xxxxx:certificate/cert1,arn:aws:acm:us-west-2:xxxxx:certificate/cert2,arn:aws:acm:us-west-2:xxxxx:certificate/cert3</span>
</code></pre></div></li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If the <code class="codehilite"><span class="err">alb.ingress.kubernetes.io/certificate-arn</span></code> annotation is not specified, the controller will attempt to add certificates to listeners that require it by matching available certs from ACM with the <code class="codehilite"><span class="err">host</span></code> field in each listener's ingress rule.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<ul>
<li>attaches a cert for <code class="codehilite"><span class="err">dev.example.com</span></code> or <code class="codehilite"><span class="err">*.example.com</span></code> to the ALB
    <div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ingress</span>
<span class="nt">annotations</span><span class="p">:</span>
  <span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alb</span>
  <span class="nt">alb.ingress.kubernetes.io/listen-ports</span><span class="p">:</span> <span class="s">&#39;[{&quot;HTTPS&quot;:443}]&#39;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dev.example.com</span>
  <span class="nt">http</span><span class="p">:</span>
    <span class="nt">paths</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/users/*</span>
    <span class="nt">backend</span><span class="p">:</span>
      <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user-service</span>
      <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div></li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Alternatively, domains specified using the <code class="codehilite"><span class="err">tls</span></code> field in the spec will also be matched with listeners and their certs will be attached from ACM. This can be used in conjunction with listener host field matching.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Example</p>
<ul>
<li>attaches certs for <code class="codehilite"><span class="err">www.example.com</span></code> to the ALB
    <div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ingress</span>
<span class="nt">annotations</span><span class="p">:</span>
  <span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alb</span>
  <span class="nt">alb.ingress.kubernetes.io/listen-ports</span><span class="p">:</span> <span class="s">&#39;[{&quot;HTTPS&quot;:443}]&#39;</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">tls</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">www.example.com</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">http</span><span class="p">:</span>
    <span class="nt">paths</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/users/*</span>
      <span class="nt">backend</span><span class="p">:</span>
        <span class="nt">serviceName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">user-service</span>
        <span class="nt">servicePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div></li>
</ul>
</div>
</li>
<li>
<p><a name="ssl-policy"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/ssl-policy</span></code></a> specifies the <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html#describe-ssl-policies">Security Policy</a> that should be assigned to the ALB, allowing you to control the protocol and ciphers.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS-1-1-2017-01</span>
</code></pre></div>

</div>
</li>
</ul>
<h2 id="custom-attributes">Custom attributes<a class="headerlink" href="#custom-attributes" title="Permanent link">&para;</a></h2>
<p>Custom attributes to LoadBalancers and TargetGroups can be controlled with following annotations:</p>
<ul>
<li>
<p><a name="load-balancer-attributes"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/load-balancer-attributes</span></code></a> specifies <a href="http://docs.aws.amazon.com/elasticloadbalancing/latest/APIReference/API_LoadBalancerAttribute.html">Load Balancer Attributes</a> that should be applied to the ALB.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<ul>
<li>enable access log to s3
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/load-balancer-attributes: access_logs.s3.enabled=true,access_logs.s3.bucket=my-access-log-bucket,access_logs.s3.prefix=my-app</span>
</code></pre></div></li>
<li>enable deletion protection
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/load-balancer-attributes: deletion_protection.enabled=true</span>
</code></pre></div></li>
<li>enable http2 support
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/load-balancer-attributes: routing.http2.enabled=true</span>
</code></pre></div></li>
<li>set idle_timeout delay to 600 seconds
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/load-balancer-attributes: idle_timeout.timeout_seconds=600</span>
</code></pre></div></li>
</ul>
</div>
</li>
<li>
<p><a name="target-group-attributes"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/target-group-attributes</span></code></a> specifies <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-target-groups.html#target-group-attributes">Target Group Attributes</a> which should be applied to Target Groups.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<ul>
<li>set the slow start duration to 5 seconds
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/target-group-attributes: slow_start.duration_seconds=5</span>
</code></pre></div></li>
<li>set the deregistration delay to 30 seconds
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/target-group-attributes: deregistration_delay.timeout_seconds=30</span>
</code></pre></div></li>
<li>enable sticky sessions
    <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/target-group-attributes: stickiness.enabled=true,stickiness.lb_cookie.duration_seconds=60</span>
</code></pre></div></li>
<li>set load balancing algorithm to least outstanding requests
            <div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/target-group-attributes: load_balancing.algorithm.type=least_outstanding_requests</span>
</code></pre></div></li>
</ul>
</div>
</li>
</ul>
<h2 id="resource-tags">Resource Tags<a class="headerlink" href="#resource-tags" title="Permanent link">&para;</a></h2>
<p>ALB Ingress controller will automatically apply following tags to AWS resources(ALB/TargetGroups/SecurityGroups) created.</p>
<ul>
<li><code class="codehilite">kubernetes.io/cluster/<span class="cp">${</span><span class="n">cluster</span><span class="o">-</span><span class="n">name</span><span class="cp">}</span>:owned</code></li>
<li><code class="codehilite">kubernetes.io/namespace: <span class="cp">${</span><span class="n">namespace</span><span class="cp">}</span></code></li>
<li><code class="codehilite">kubernetes.io/ingress-name: <span class="cp">${</span><span class="n">ingress</span><span class="o">-</span><span class="n">name</span><span class="cp">}</span></code></li>
</ul>
<p>In addition, you can use annotations to specify additional tags</p>
<ul>
<li>
<p><a name="tags"><code class="codehilite"><span class="err">alb.ingress.kubernetes.io/tags</span></code></a> specifies additional tags that will be applied to AWS resources created.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<div class="codehilite"><pre><span></span><code><span class="err">alb.ingress.kubernetes.io/tags: Environment=dev,Team=test</span>
</code></pre></div>

</div>
</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../controller/setup/" title="Setup" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Setup
              </span>
            </div>
          </a>
        
        
          <a href="../spec/" title="Spec" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Spec
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../../.."}})</script>
      
    
  </body>
</html>