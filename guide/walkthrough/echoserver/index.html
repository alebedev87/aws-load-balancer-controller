


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.0">
    
    
      
        <title>Echo server - AWS ALB Ingress Controller</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.18ac144a.min.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.616af814.min.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="green">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#walkthrough-echoserver" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="AWS ALB Ingress Controller" class="md-header-nav__button md-logo" aria-label="AWS ALB Ingress Controller">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            AWS ALB Ingress Controller
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Echo server
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/kubernetes-sigs/aws-alb-ingress-controller/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kubernetes-sigs/aws-alb-ingress-controller
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="AWS ALB Ingress Controller" class="md-nav__button md-logo" aria-label="AWS ALB Ingress Controller">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    AWS ALB Ingress Controller
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/kubernetes-sigs/aws-alb-ingress-controller/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    kubernetes-sigs/aws-alb-ingress-controller
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Home
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Home" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Home
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." title="Welcome" class="md-nav__link">
      Welcome
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../controller/how-it-works/" title="How it works" class="md-nav__link">
      How it works
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Guide
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      Controller
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Controller" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Controller
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../controller/config/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../controller/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Ingress
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Ingress" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Ingress
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../ingress/annotation/" title="Annotation" class="md-nav__link">
      Annotation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ingress/spec/" title="Spec" class="md-nav__link">
      Spec
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ingress/pod-conditions/" title="Pod Conditions" class="md-nav__link">
      Pod Conditions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      External DNS
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="External DNS" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        External DNS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../external-dns/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Tasks
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Tasks" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Tasks
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tasks/ssl_redirect/" title="SSL Redirect" class="md-nav__link">
      SSL Redirect
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Cognito
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Cognito" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Cognito
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cognito/setup/" title="Cognito Integration" class="md-nav__link">
      Cognito Integration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6" checked>
    
    <label class="md-nav__link" for="nav-2-6">
      Walkthrough
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Walkthrough" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Walkthrough
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Echo server
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Echo server" class="md-nav__link md-nav__link--active">
      Echo server
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-the-eks-cluster" class="md-nav__link">
    Create the EKS cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-alb-ingress-controller" class="md-nav__link">
    Deploy the ALB ingress controller
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-echoserver-resources" class="md-nav__link">
    Deploy the echoserver resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-ingress-for-echoserver" class="md-nav__link">
    Deploy ingress for echoserver
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-external-dns-to-manage-dns-automatically" class="md-nav__link">
    Setup external-DNS to manage DNS automatically
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kube2iam-setup" class="md-nav__link">
    Kube2iam setup
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      About
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="About" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../CONTRIBUTING/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../BUILDING/" title="Building" class="md-nav__link">
      Building
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ROADMAP/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-the-eks-cluster" class="md-nav__link">
    Create the EKS cluster
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-alb-ingress-controller" class="md-nav__link">
    Deploy the ALB ingress controller
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-echoserver-resources" class="md-nav__link">
    Deploy the echoserver resources
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-ingress-for-echoserver" class="md-nav__link">
    Deploy ingress for echoserver
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-external-dns-to-manage-dns-automatically" class="md-nav__link">
    Setup external-DNS to manage DNS automatically
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kube2iam-setup" class="md-nav__link">
    Kube2iam setup
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/kubernetes-sigs/aws-alb-ingress-controller/edit/master/docs/guide/walkthrough/echoserver.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="walkthrough-echoserver">walkthrough: echoserver<a class="headerlink" href="#walkthrough-echoserver" title="Permanent link">&para;</a></h1>
<p>In this walkthrough, you'll</p>
<ul>
<li>Create a cluster with EKS</li>
<li>Deploy an alb-ingress-controller</li>
<li>Create deployments and ingress resources in the cluster</li>
<li>Use <a href="https://github.com/kubernetes-incubator/external-dns">external-dns</a> to create a DNS record<ul>
<li>This assumes you have a route53 hosted zone available. Otherwise you can skip this, but you'll only be able to address the service from the ALB's DNS.</li>
</ul>
</li>
</ul>
<h2 id="create-the-eks-cluster">Create the EKS cluster<a class="headerlink" href="#create-the-eks-cluster" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Install <code>eksctl</code>: https://eksctl.io</p>
</li>
<li>
<p>Create EKS cluster via eksctl</p>
<div class="highlight"><pre><span></span><code>eksctl create cluster
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="go">2018-08-14T11:19:09-07:00 [ℹ]  setting availability zones to [us-west-2c us-west-2a us-west-2b]</span>
<span class="go">2018-08-14T11:19:09-07:00 [ℹ]  importing SSH public key &quot;/Users/kamador/.ssh/id_rsa.pub&quot; as &quot;eksctl-exciting-gopher-1534270749-b7:71:da:f6:f3:63:7a:ee:ad:7a:10:37:28:ff:44:d1&quot;</span>
<span class="go">2018-08-14T11:19:10-07:00 [ℹ]  creating EKS cluster &quot;exciting-gopher-1534270749&quot; in &quot;us-west-2&quot; region</span>
<span class="go">2018-08-14T11:19:10-07:00 [ℹ]  creating ServiceRole stack &quot;EKS-exciting-gopher-1534270749-ServiceRole&quot;</span>
<span class="go">2018-08-14T11:19:10-07:00 [ℹ]  creating VPC stack &quot;EKS-exciting-gopher-1534270749-VPC&quot;</span>
<span class="go">2018-08-14T11:19:50-07:00 [✔]  created ServiceRole stack &quot;EKS-exciting-gopher-1534270749-ServiceRole&quot;</span>
<span class="go">2018-08-14T11:20:30-07:00 [✔]  created VPC stack &quot;EKS-exciting-gopher-1534270749-VPC&quot;</span>
<span class="go">2018-08-14T11:20:30-07:00 [ℹ]  creating control plane &quot;exciting-gopher-1534270749&quot;</span>
<span class="go">2018-08-14T11:31:52-07:00 [✔]  created control plane &quot;exciting-gopher-1534270749&quot;</span>
<span class="go">2018-08-14T11:31:52-07:00 [ℹ]  creating DefaultNodeGroup stack &quot;EKS-exciting-gopher-1534270749-DefaultNodeGroup&quot;</span>
<span class="go">2018-08-14T11:35:33-07:00 [✔]  created DefaultNodeGroup stack &quot;EKS-exciting-gopher-1534270749-DefaultNodeGroup&quot;</span>
<span class="go">2018-08-14T11:35:33-07:00 [✔]  all EKS cluster &quot;exciting-gopher-1534270749&quot; resources has been created</span>
<span class="go">2018-08-14T11:35:33-07:00 [✔]  saved kubeconfig as &quot;/Users/kamador/.kube/config&quot;</span>
<span class="go">2018-08-14T11:35:34-07:00 [ℹ]  the cluster has 0 nodes</span>
<span class="go">2018-08-14T11:35:34-07:00 [ℹ]  waiting for at least 2 nodes to become ready</span>
<span class="go">2018-08-14T11:36:05-07:00 [ℹ]  the cluster has 2 nodes</span>
<span class="go">2018-08-14T11:36:05-07:00 [ℹ]  node &quot;ip-192-168-139-176.us-west-2.compute.internal&quot; is ready</span>
<span class="go">2018-08-14T11:36:05-07:00 [ℹ]  node &quot;ip-192-168-214-126.us-west-2.compute.internal&quot; is ready</span>
<span class="go">2018-08-14T11:36:05-07:00 [✔]  EKS cluster &quot;exciting-gopher-1534270749&quot; in &quot;us-west-2&quot; region is ready</span>
</code></pre></div>

</li>
</ol>
<h2 id="deploy-the-alb-ingress-controller">Deploy the ALB ingress controller<a class="headerlink" href="#deploy-the-alb-ingress-controller" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Download the example alb-ingress-manifest locally.</p>
<div class="highlight"><pre><span></span><code>wget https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.8/docs/examples/alb-ingress-controller.yaml
wget https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.8/docs/examples/rbac-role.yaml
</code></pre></div>

</li>
<li>
<p>Edit the manifest and set the following parameters and environment variables.</p>
<ul>
<li>
<p><code>cluster-name</code>: name of the cluster.</p>
</li>
<li>
<p><code>AWS_ACCESS_KEY_ID</code>: access key id that alb controller can use to communicate with AWS. This is only used for convenience of this example. It will keep the credentials in plain text within this manifest. It's recommended a project such as kube2iam is used to resolve access. <strong>You will need to uncomment this from the manifest</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS_ACCESS_KEY_ID</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">KEYVALUE</span>
</code></pre></div>

</li>
<li>
<p><code>AWS_SECRET_ACCESS_KEY</code>: secret access key that alb controller can use to communicate with AWS. This is only used for convenience of this example. It will keep the credentials in plain text within this manifest. It's recommended a project such as kube2iam is used to resolve access. <strong>You will need to uncomment this from the manifest</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AWS_SECRET_ACCESS_KEY</span>
  <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SECRETVALUE</span>
</code></pre></div>

</li>
</ul>
</li>
<li>
<p>Deploy the modified alb-ingress-controller.</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f rbac-role.yaml
kubectl apply -f alb-ingress-controller.yaml
</code></pre></div>

<blockquote>
<p>The manifest above will deploy the controller to the <code>kube-system</code> namespace.</p>
</blockquote>
</li>
<li>
<p>Verify the deployment was successful and the controller started.</p>
<div class="highlight"><pre><span></span><code>kubectl logs -n kube-system <span class="k">$(</span>kubectl get po -n kube-system <span class="p">|</span> egrep -o alb-ingress<span class="o">[</span>a-zA-Z0-9-<span class="o">]</span>+<span class="k">)</span>
</code></pre></div>

<p>Should display output similar to the following.</p>
<div class="highlight"><pre><span></span><code>-------------------------------------------------------------------------------
AWS ALB Ingress controller
Release:    UNKNOWN
Build:      UNKNOWN
Repository: UNKNOWN
-------------------------------------------------------------------------------

I0725 11:22:06.464996   16433 main.go:159] Creating API client for http://localhost:8001
I0725 11:22:06.563336   16433 main.go:203] Running in Kubernetes cluster version v1.8+ (v1.8.9+coreos.1) - git (clean) commit cd373fe93e046b0a0bc7e4045af1bf4171cea395 - platform linux/amd64
I0725 11:22:06.566255   16433 alb.go:80] ALB resource names will be prefixed with 2f92da62
I0725 11:22:06.645910   16433 alb.go:163] Starting AWS ALB Ingress controller
</code></pre></div>

</li>
</ol>
<h2 id="deploy-the-echoserver-resources">Deploy the echoserver resources<a class="headerlink" href="#deploy-the-echoserver-resources" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Deploy all the echoserver resources (namespace, service, deployment)</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.8/docs/examples/echoservice/echoserver-namespace.yaml <span class="o">&amp;&amp;</span><span class="se">\</span>
kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.8/docs/examples/echoservice/echoserver-service.yaml <span class="o">&amp;&amp;</span><span class="se">\</span>
kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.8/docs/examples/echoservice/echoserver-deployment.yaml
</code></pre></div>

</li>
<li>
<p>List all the resources to ensure they were created.</p>
<div class="highlight"><pre><span></span><code>kubectl get -n echoserver deploy,svc
</code></pre></div>

<p>Should resolve similar to the following.</p>
<div class="highlight"><pre><span></span><code><span class="go">NAME             CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE</span>
<span class="go">svc/echoserver   10.3.31.76   &lt;nodes&gt;       80:31027/TCP   4d</span>

<span class="go">NAME                DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="go">deploy/echoserver   1         1         1            1           4d</span>
</code></pre></div>

</li>
</ol>
<h2 id="deploy-ingress-for-echoserver">Deploy ingress for echoserver<a class="headerlink" href="#deploy-ingress-for-echoserver" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Download the echoserver ingress manifest locally.</p>
<div class="highlight"><pre><span></span><code>wget https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.8/docs/examples/echoservice/echoserver-ingress.yaml
</code></pre></div>

</li>
<li>
<p>Configure the subnets, either by add annotation to the ingress or add tags to subnets.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you'd like to use external dns, alter the host field to a domain that you own in Route 53. Assuming you managed <code>example.com</code> in Route 53.</p>
</div>
<ul>
<li>
<p>Edit the <code>alb.ingress.kubernetes.io/subnets</code> annotation to include at least two subnets.
    <div class="highlight"><pre><span></span><code>eksctl get cluster exciting-gopher-1534270749
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="go">NAME                        VERSION STATUS         CREATED          VPC                     SUBNETS                             SECURITYGROUPS</span>
<span class="go">exciting-gopher-1534270749  1.10    ACTIVE  2018-08-14T18:20:32Z    vpc-0aa01b07b3c922c9c   subnet-05e1c98ed0f5b109e,subnet-07f5bb81f661df61b,subnet-0a4e6232630820516  sg-05ceb5eee9fd7cac4</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">echoserver</span>
    <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">echoserver</span>
    <span class="nt">annotations</span><span class="p">:</span>
        <span class="nt">alb.ingress.kubernetes.io/scheme</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">internet-facing</span>
        <span class="nt">alb.ingress.kubernetes.io/target-type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ip</span>
        <span class="nt">alb.ingress.kubernetes.io/subnets</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">subnet-05e1c98ed0f5b109e,subnet-07f5bb81f661df61b,subnet-0a4e6232630820516</span>
        <span class="nt">alb.ingress.kubernetes.io/tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Environment=dev,Team=test</span>
<span class="nt">spec</span><span class="p">:</span>
    <span class="nt">rules</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">echoserver.example.com</span>
        <span class="l l-Scalar l-Scalar-Plain">http</span><span class="p p-Indicator">:</span>
        <span class="nt">paths</span><span class="p">:</span>
</code></pre></div>

</li>
<li>
<p>Adding tags to subnets for auto-discovery(instead of <code>alb.ingress.kubernetes.io/subnets</code> annotation)</p>
<p>you must include the following tags on desired subnets.</p>
<ul>
<li><code>kubernetes.io/cluster/$CLUSTER_NAME</code> where <code>$CLUSTER_NAME</code> is the same <code>CLUSTER_NAME</code> specified in the above step.</li>
<li><code>kubernetes.io/role/internal-elb</code> should be set to <code>1</code> or an empty tag value for internal load balancers.</li>
<li><code>kubernetes.io/role/elb</code> should be set to <code>1</code> or an empty tag value for internet-facing load balancers.</li>
</ul>
<p>An example of a subnet with the correct tags for the cluster <code>joshcalico</code> is as follows.</p>
<p><img alt="subnet-tags" src="../../../imgs/subnet-tags.png" /></p>
</li>
</ul>
</li>
<li>
<p>Deploy the ingress resource for echoserver</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f echoserver-ingress.yaml
</code></pre></div>

</li>
<li>
<p>Verify the alb-ingress-controller creates the resources</p>
<div class="highlight"><pre><span></span><code>kubectl logs -n kube-system <span class="k">$(</span>kubectl get po -n kube-system <span class="p">|</span> egrep -o <span class="s1">&#39;alb-ingress[a-zA-Z0-9-]+&#39;</span><span class="k">)</span> <span class="p">|</span> grep <span class="s1">&#39;echoserver\/echoserver&#39;</span>
</code></pre></div>

<p>You should see similar to the following.</p>
<div class="highlight"><pre><span></span><code><span class="go">echoserver/echoserver: Start ELBV2 (ALB) creation.</span>
<span class="go">echoserver/echoserver: Completed ELBV2 (ALB) creation. Name: joshcalico-echoserver-echo-2ad7 | ARN: arn:aws:elasticloadbalancing:us-east-2:432733164488:loadbalancer/app/joshcalico-echoserver-echo-2ad7/4579643c6f757be9</span>
<span class="go">echoserver/echoserver: Start TargetGroup creation.</span>
<span class="go">echoserver/echoserver: Succeeded TargetGroup creation. ARN: arn:aws:elasticloadbalancing:us-east-2:432733164488:targetgroup/joshcalico-31027-HTTP-6657576/77ef58891a00263e | Name: joshcalico-31027-HTTP-6657576.</span>
<span class="go">echoserver/echoserver: Start Listener creation.</span>
<span class="go">echoserver/echoserver: Completed Listener creation. ARN: arn:aws:elasticloadbalancing:us-east-2:432733164488:listener/app/joshcalico-echoserver-echo-2ad7/4579643c6f757be9/2b2987fa3739c062 | Port: 80 | Proto: HTTP.</span>
<span class="go">echoserver/echoserver: Start Rule creation.</span>
<span class="go">echoserver/echoserver: Completed Rule creation. Rule Priority: &quot;1&quot; | Condition: [{    Field: &quot;host-header&quot;,    Values: [&quot;echoserver.joshrosso.com&quot;]  },{    Field: &quot;path-pattern&quot;,    Values: [&quot;/&quot;]  }]</span>
</code></pre></div>

</li>
<li>
<p>Check the events of the ingress to see what has occur.</p>
<div class="highlight"><pre><span></span><code>kubectl describe ing -n echoserver echoserver
</code></pre></div>

<p>You should see similar to the following.</p>
<div class="highlight"><pre><span></span><code><span class="go">Name:                   echoserver</span>
<span class="go">Namespace:              echoserver</span>
<span class="go">Address:                joshcalico-echoserver-echo-2ad7-1490890749.us-east-2.elb.amazonaws.com</span>
<span class="go">Default backend:        default-http-backend:80 (10.2.1.28:8080)</span>
<span class="go">Rules:</span>
<span class="go">  Host                          Path    Backends</span>
<span class="go">  ----                          ----    --------</span>
<span class="go">  echoserver.joshrosso.com</span>
<span class="go">                                /       echoserver:80 (&lt;none&gt;)</span>
<span class="go">Annotations:</span>
<span class="go">Events:</span>
<span class="go">  FirstSeen     LastSeen        Count   From                    SubObjectPath   Type            Reason  Message</span>
<span class="go">  ---------     --------        -----   ----                    -------------   --------        ------  -------</span>
<span class="go">  3m            3m              1       ingress-controller                      Normal          CREATE  Ingress echoserver/echoserver</span>
<span class="go">  3m            32s             3       ingress-controller                      Normal          UPDATE  Ingress echoserver/echoserver</span>
</code></pre></div>

<p>The address seen above is the ALB's DNS record. This will be referenced via records created by external-dns.</p>
</li>
</ol>
<h2 id="setup-external-dns-to-manage-dns-automatically">Setup external-DNS to manage DNS automatically<a class="headerlink" href="#setup-external-dns-to-manage-dns-automatically" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>Ensure your nodes (on which External DNS runs) have the correct IAM permission required for external-dns. See https://github.com/kubernetes-incubator/external-dns/blob/master/docs/tutorials/aws.md#iam-permissions.</p>
</li>
<li>
<p>Download external-dns to manage Route 53.</p>
<div class="highlight"><pre><span></span><code>wget https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.8/docs/examples/external-dns.yaml
</code></pre></div>

</li>
<li>
<p>Edit the <code>--domain-filter</code> flag to include your hosted zone(s)</p>
<p>The following example is for a hosted zone test-dns.com</p>
<div class="highlight"><pre><span></span><code><span class="nt">args</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--source=service</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--source=ingress</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--domain-filter=test-dns.com</span> <span class="c1"># will make ExternalDNS see only the hosted zones matching provided domain, omit to process all available hosted zones</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--provider=aws</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--policy=upsert-only</span> <span class="c1"># would prevent ExternalDNS from deleting any records, omit to enable full synchronization</span>
</code></pre></div>

</li>
<li>
<p>Deploy external-dns</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f external-dns.yaml
</code></pre></div>

</li>
<li>
<p>Verify the DNS has propagated</p>
<div class="highlight"><pre><span></span><code>dig echoserver.josh-test-dns.com
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="go">;; QUESTION SECTION:</span>
<span class="go">;echoserver.josh-test-dns.com.  IN      A</span>

<span class="go">;; ANSWER SECTION:</span>
<span class="go">echoserver.josh-test-dns.com. 60 IN     A       13.59.147.105</span>
<span class="go">echoserver.josh-test-dns.com. 60 IN     A       18.221.65.39</span>
<span class="go">echoserver.josh-test-dns.com. 60 IN     A       52.15.186.25</span>
</code></pre></div>

</li>
<li>
<p>Once it has, you can make a call to echoserver and it should return a response payload.</p>
<div class="highlight"><pre><span></span><code>curl echoserver.josh-test-dns.com
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="go">CLIENT VALUES:</span>
<span class="go">client_address=10.0.50.185</span>
<span class="go">command=GET</span>
<span class="go">real path=/</span>
<span class="go">query=nil</span>
<span class="go">request_version=1.1</span>
<span class="go">request_uri=http://echoserver.josh-test-dns.com:8080/</span>

<span class="go">SERVER VALUES:</span>
<span class="go">server_version=nginx: 1.10.0 - lua: 10001</span>

<span class="go">HEADERS RECEIVED:</span>
<span class="go">accept=*/*</span>
<span class="go">host=echoserver.josh-test-dns.com</span>
<span class="go">user-agent=curl/7.54.0</span>
<span class="go">x-amzn-trace-id=Root=1-59c08da5-113347df69640735312371bd</span>
<span class="go">x-forwarded-for=67.173.237.250</span>
<span class="go">x-forwarded-port=80</span>
<span class="go">x-forwarded-proto=http</span>
<span class="go">BODY:</span>
</code></pre></div>

</li>
</ol>
<h2 id="kube2iam-setup">Kube2iam setup<a class="headerlink" href="#kube2iam-setup" title="Permanent link">&para;</a></h2>
<p>follow below steps if you want to use kube2iam to provide the AWS credentials</p>
<ol>
<li>
<p>configure the proper policy
    The policy to be used can be fetched from https://raw.githubusercontent.com/kubernetes-sigs/aws-alb-ingress-controller/v1.1.8/docs/examples/iam-policy.json</p>
</li>
<li>
<p>configure the proper role and create the trust relationship
    You have to find which role is associated with your K8S nodes. Once you found take note of the full arn:</p>
<div class="highlight"><pre><span></span><code>arn:aws:iam::XXXXXXXXXXXX:role/k8scluster-node
</code></pre></div>

</li>
<li>
<p>create the role, called k8s-alb-controller, attach the above policy and add a Trust Relationship like:</p>
<div class="highlight"><pre><span></span><code>{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Sid&quot;: &quot;&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Principal&quot;: {
        &quot;Service&quot;: &quot;ec2.amazonaws.com&quot;
      },
      &quot;Action&quot;: &quot;sts:AssumeRole&quot;
    },
    {
      &quot;Sid&quot;: &quot;&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Principal&quot;: {
        &quot;AWS&quot;: &quot;arn:aws:iam::XXXXXXXXXXXX:role/k8scluster-node&quot;
      },
      &quot;Action&quot;: &quot;sts:AssumeRole&quot;
    }
  ]
}
</code></pre></div>

<p>The new role will have a similar arn:</p>
<div class="highlight"><pre><span></span><code>arn:aws:iam:::XXXXXXXXXXXX:role/k8s-alb-controller
</code></pre></div>

</li>
<li>
<p>update the alb-ingress-controller.yaml</p>
<p>Add the annotations in the template's metadata point</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">selector</span><span class="p">:</span>
  <span class="nt">matchLabels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alb-ingress-controller</span>
<span class="nt">strategy</span><span class="p">:</span>
  <span class="nt">rollingUpdate</span><span class="p">:</span>
    <span class="nt">maxSurge</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">maxUnavailable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
<span class="nt">template</span><span class="p">:</span>
  <span class="nt">metadata</span><span class="p">:</span>
    <span class="nt">annotations</span><span class="p">:</span>
      <span class="nt">iam.amazonaws.com/role</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">arn:aws:iam:::XXXXXXXXXXXX:role/k8s-alb-controller</span>
</code></pre></div>

</li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../cognito/setup/" title="Cognito Integration" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Cognito Integration
              </div>
            </div>
          </a>
        
        
          <a href="../../../CONTRIBUTING/" title="Contributing" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Contributing
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>